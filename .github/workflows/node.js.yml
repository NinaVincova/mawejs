name: Node.js CI + Discord notification

on:
  pull_request:
    branches:
      - "master"
      - "issue-fix"

jobs:
  build:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        node-version: [22.x]
    steps:
    - uses: actions/checkout@v4
    - name: Set up Node.js
      uses: actions/setup-node@v4
      with:
        node-version: ${{ matrix.node-version }}
        cache: 'npm'
    - run: npm ci
    - run: npm run build --if-present
    # Uncomment the line below if you want to include the electron-build step
    # - run: npm run electron-build
    - name: Send Discord Notification
      if: always() # Ensures this step runs regardless of success or failure
      run: |
        curl -X POST -H "Content-Type: application/json" \
        -d '{
          "username": "GitHub Actions",
          "avatar_url": "https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png",
          "embeds": [{
            "title": "Build Notification",
            "description": "The job has **${{ job.status }}** for branch `${{ github.ref_name }}`.",
            "color": "${{ job.status == 'success' && 3066993 || 15158332 }}",
            "fields": [
              {
                "name": "Repository",
                "value": "${{ github.repository }}"
              },
              {
                "name": "Event",
                "value": "${{ github.event_name }}"
              }
            ],
            "timestamp": "$(date -u +"%Y-%m-%dT%H:%M:%SZ")"
          }]
        }' \
        https://discord.com/api/webhooks/1310623401638887526/sNNe8i_2j9pu3uG-7UNnPGshWRLkakupS4ENTFDMklyhAYzV6m_Ni6yi8o_ql2kvE5ya
